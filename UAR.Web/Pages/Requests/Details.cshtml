@page "{id:int}"
@model UAR.Web.Pages.Requests.DetailsModel

@if (TempData["DebugEmailSubject"] is string debugSubject)
{
    <div class="modal fade show" id="debugEmailModal" tabindex="-1" style="display: block;" aria-modal="true" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Debug Approval Email</h5>
                    <a class="btn-close" href="@Url.Page("/Requests/Details", new { id = Model.RequestDetails?.Id ?? 0 })" aria-label="Close"></a>
                </div>
                <div class="modal-body">
                    <p class="mb-1"><strong>Subject:</strong> @debugSubject</p>
                    <pre class="bg-light p-3 rounded-3">@TempData["DebugEmailBody"]</pre>
                    <div class="d-flex flex-wrap gap-2">
                        @if (TempData["DebugEmailApproveUrl"] is string approveUrl && !string.IsNullOrWhiteSpace(approveUrl))
                        {
                            <a class="btn btn-success" href="@approveUrl">Approve</a>
                        }
                        @if (TempData["DebugEmailRejectUrl"] is string rejectUrl && !string.IsNullOrWhiteSpace(rejectUrl))
                        {
                            <a class="btn btn-danger" href="@rejectUrl">Reject</a>
                        }
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-outline-secondary" href="@Url.Page("/Requests/Details", new { id = Model.RequestDetails?.Id ?? 0 })">Close</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

@if (Model.RequestDetails is null)
{
    <div class="alert alert-warning">Request not found.</div>
}
else
{
    <style>
        @@media print {
            .no-print { display: none !important; }
        }
    </style>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="mb-1">Request @Model.RequestDetails.RequestNumber</h2>
            <p class="text-muted mb-0">Submitted @Model.RequestDetails.SubmittedOn.ToLocalTime().ToString("g").</p>
        </div>
        <div class="d-flex gap-2 no-print">
            <button type="button" class="btn btn-outline-primary" onclick="window.print()">Print</button>
            <a class="btn btn-outline-secondary" asp-page="/Requests/Index">Back to log</a>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">Workflow Timeline</h5>
        <dl class="row mb-0">
            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">@Model.RequestDetails.Status</dd>
            <dt class="col-sm-3">Submitted On</dt>
            <dd class="col-sm-9">@Model.RequestDetails.SubmittedOn.ToLocalTime().ToString("g")</dd>
            <dt class="col-sm-3">Approval Decision</dt>
            <dd class="col-sm-9">@Model.RequestDetails.ApprovalDecision</dd>
            <dt class="col-sm-3">Approved On</dt>
            <dd class="col-sm-9">@Model.RequestDetails.ApprovedOn?.ToLocalTime().ToString("g")</dd>
            <dt class="col-sm-3">Approved By</dt>
            <dd class="col-sm-9">@Model.RequestDetails.ApprovedBy</dd>
            <dt class="col-sm-3">Rejected On</dt>
            <dd class="col-sm-9">@Model.RequestDetails.RejectedOn?.ToLocalTime().ToString("g")</dd>
            <dt class="col-sm-3">Rejected By</dt>
            <dd class="col-sm-9">@Model.RequestDetails.RejectedBy</dd>
        </dl>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">General Request Info</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Company</label>
                <div class="form-control-static">@Model.RequestDetails.Company</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Request Number</label>
                <div class="form-control-static">@Model.RequestDetails.RequestNumber</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Employee Name Change</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeNameChange</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Employee First Name</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeFirstName</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Employee Middle Name</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeMiddleName</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Employee Last Name</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeLastName</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Job Title</label>
                <div class="form-control-static">@Model.RequestDetails.JobTitle</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Desired Effective Date</label>
                <div class="form-control-static">@Model.RequestDetails.DesiredEffectiveDate</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Requestor Phone Number</label>
                <div class="form-control-static">@Model.RequestDetails.RequestorPhoneNumber</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Employee Status</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeStatus</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Employee Type</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeType</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Transfer From Program</label>
                <div class="form-control-static">@Model.RequestDetails.TransferFromProgram</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Leave Of Absence</label>
                <div class="form-control-static">@Model.RequestDetails.LeaveOfAbsence</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Region Name</label>
                <div class="form-control-static">@Model.RequestDetails.RegionName</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Program 1</label>
                <div class="form-control-static">@Model.RequestDetails.Program1</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Program 2</label>
                <div class="form-control-static">@Model.RequestDetails.Program2</div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Program 3</label>
                <div class="form-control-static">@Model.RequestDetails.Program3</div>
            </div>
            <div class="col-md-12">
                <label class="form-label">Other Programs</label>
                <div class="form-control-static">@Model.RequestDetails.OtherPrograms</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Employee Device Types</label>
                <div class="form-control-static">@Model.RequestDetails.EmployeeDeviceTypes</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Other Device Type</label>
                <div class="form-control-static">@Model.RequestDetails.OtherDeviceType</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">HR Representative Name</label>
                <div class="form-control-static">@Model.RequestDetails.HrRepresentativeName</div>
            </div>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">Status &amp; Approval</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Status</label>
                <div class="form-control-static">@Model.RequestDetails.Status</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Authorized Approver</label>
                <div class="form-control-static">@Model.RequestDetails.AuthorizedApprover</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Program Administrator</label>
                <div class="form-control-static">@Model.RequestDetails.ProgramAdministrator</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">RDO Approver</label>
                <div class="form-control-static">@Model.RequestDetails.RdoApprover</div>
            </div>
            <div class="col-md-12">
                <label class="form-label">Rejection Reason</label>
                <div class="form-control-static">@Model.RequestDetails.RejectionReason</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Approval Decision</label>
                <div class="form-control-static">@Model.RequestDetails.ApprovalDecision</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Approved On</label>
                <div class="form-control-static">@Model.RequestDetails.ApprovedOn?.ToLocalTime().ToString("g")</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Approved By</label>
                <div class="form-control-static">@Model.RequestDetails.ApprovedBy</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Rejected On</label>
                <div class="form-control-static">@Model.RequestDetails.RejectedOn?.ToLocalTime().ToString("g")</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Rejected By</label>
                <div class="form-control-static">@Model.RequestDetails.RejectedBy</div>
            </div>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">Email / Network Access</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Email Account</label>
                <div class="form-control-static">@Model.RequestDetails.EmailAccount</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Account Enable/Disable</label>
                <div class="form-control-static">@Model.RequestDetails.AccountEnableDisable</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Forwarding Email Address</label>
                <div class="form-control-static">@Model.RequestDetails.ForwardingEmailAddress</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Assigned Account Username</label>
                <div class="form-control-static">@Model.RequestDetails.AssignedAccountUsername</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Office365 License</label>
                <div class="form-control-static">@Model.RequestDetails.Office365License</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Additional Microsoft Products</label>
                <div class="form-control-static">@Model.RequestDetails.AdditionalMicrosoftProducts</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Create Email Groups</label>
                <div class="form-control-static">@Model.RequestDetails.CreateEmailGroups</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">SharePoint Site URL</label>
                <div class="form-control-static">@Model.RequestDetails.SharePointSiteUrl</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">SharePoint Site Description</label>
                <div class="form-control-static">@Model.RequestDetails.SharePointSiteDescription</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Existing Email Groups</label>
                <div class="form-control-static">@Model.RequestDetails.ExistingEmailGroups</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Additional SharePoint Access</label>
                <div class="form-control-static">@Model.RequestDetails.AdditionalSharepointAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Network Shared Drives</label>
                <div class="form-control-static">@Model.RequestDetails.NetworkSharedDrives</div>
            </div>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">HR / Finance / Operations Access</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">TOP Access</label>
                <div class="form-control-static">@Model.RequestDetails.TopAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Kronos Access Types</label>
                <div class="form-control-static">@Model.RequestDetails.KronosAccessTypes</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Kronos Access Details</label>
                <div class="form-control-static">@Model.RequestDetails.KronosAccessDetails</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Lawson Access</label>
                <div class="form-control-static">@Model.RequestDetails.LawsonAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Additional Lawson Access</label>
                <div class="form-control-static">@Model.RequestDetails.AdditionalLawsonAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Mileage Access</label>
                <div class="form-control-static">@Model.RequestDetails.MileageAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Comerica Banking Access</label>
                <div class="form-control-static">@Model.RequestDetails.ComericaBankingAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Trust Rep Payee Access</label>
                <div class="form-control-static">@Model.RequestDetails.TrustRepPayeeAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Quickbooks Access</label>
                <div class="form-control-static">@Model.RequestDetails.QuickbooksAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">CoWorker Access</label>
                <div class="form-control-static">@Model.RequestDetails.CoWorkerAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Additional HR/Finance Access</label>
                <div class="form-control-static">@Model.RequestDetails.AdditionalHrFinanceAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">OrderConnect Access</label>
                <div class="form-control-static">@Model.RequestDetails.OrderConnectAccess</div>
            </div>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">Program / Clinical Systems</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Caminar Access</label>
                <div class="form-control-static">@Model.RequestDetails.CaminarAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Avatar Access</label>
                <div class="form-control-static">@Model.RequestDetails.AvatarAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Adverse Event Supervisor Access</label>
                <div class="form-control-static">@Model.RequestDetails.AdverseEventSupervisorAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Adverse Event Additional Program Access</label>
                <div class="form-control-static">@Model.RequestDetails.AdverseEventAdditionalProgramAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Business Intelligence Role</label>
                <div class="form-control-static">@Model.RequestDetails.BusinessIntelligenceRole</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Adverse Event Non-Employee Access</label>
                <div class="form-control-static">@Model.RequestDetails.AdverseEventNonEmployeeAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Telehealth Access</label>
                <div class="form-control-static">@Model.RequestDetails.TelehealthAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Next Telehealth Session</label>
                <div class="form-control-static">@Model.RequestDetails.NextTelehealthSession</div>
            </div>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">Pharmerica / Call Center / Adobe</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Pharmerica Access</label>
                <div class="form-control-static">@Model.RequestDetails.PharmericaAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Pharmerica User Role</label>
                <div class="form-control-static">@Model.RequestDetails.PharmericaUserRole</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Pharmerica Username</label>
                <div class="form-control-static">@Model.RequestDetails.PharmericaUsername</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Call Center Access</label>
                <div class="form-control-static">@Model.RequestDetails.CallCenterAccess</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Adobe Sign Account</label>
                <div class="form-control-static">@Model.RequestDetails.AdobeSignAccount</div>
            </div>
        </div>
    </div>

    <div class="section-card p-3 mb-3">
        <h5 class="mb-3">Licensing &amp; Other</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Copilot License</label>
                <div class="form-control-static">@Model.RequestDetails.CopilotLicense</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Smartsheet License</label>
                <div class="form-control-static">@Model.RequestDetails.SmartsheetLicense</div>
            </div>
            <div class="col-md-6">
                <label class="form-label">E-Fax</label>
                <div class="form-control-static">@Model.RequestDetails.EFax</div>
            </div>
            <div class="col-md-12">
                <label class="form-label">Additional Comments</label>
                <div class="form-control-static">@Model.RequestDetails.AdditionalComments</div>
            </div>
        </div>
    </div>
}
