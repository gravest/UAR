@page "{id:int}"
@model UAR.Web.Pages.Requests.EditModel
@using UAR.Web.Services

<h2 class="mb-3">Edit User Access Request</h2>
<p class="text-muted">Update fields below and save changes. Required fields are marked with an asterisk (*).</p>

<div class="mb-3">
    <label class="form-label">UAR Number</label>
    <div class="form-control-static">@Model.RequestForm.RequestNumber</div>
    <div class="form-hint">UAR number is read-only once created.</div>
</div>

@{
    var currentStatus = Model.RequestForm.Status;
    var isTerminalStatus = Model.IsTerminalStatus(currentStatus);
    var isDraft = ApprovalWorkflow.IsDraftStatus(currentStatus);
    var isPending = ApprovalWorkflow.IsPendingApprovalStatus(currentStatus);
}

@if (isTerminalStatus)
{
    <div class="alert alert-warning" role="alert">
        This request is @Model.RequestForm.Status and can no longer be updated.
    </div>
}

<form method="post" class="mb-5">
    <input type="hidden" asp-for="RequestForm.Id" />
    <input type="hidden" asp-for="RequestForm.RequestNumber" />
    <input type="hidden" asp-for="RequestForm.SubmittedOn" />
    <div asp-validation-summary="All" class="text-danger mb-3"></div>

    @await Html.PartialAsync("_RequestFormFields", Model)

    <div class="d-flex flex-wrap gap-2">
        @if (!isTerminalStatus)
        {
            if (isDraft)
            {
                <button type="submit" class="btn btn-outline-secondary" name="WorkflowAction" value="SaveDraft">
                    Save as Draft
                </button>
                <button type="submit" class="btn btn-primary" name="WorkflowAction" value="SubmitForApproval">
                    Submit for Approval
                </button>
            }
            else if (isPending)
            {
                <button type="submit" class="btn btn-outline-secondary" name="WorkflowAction" value="SavePending">
                    Save changes
                </button>
                <button type="submit" class="btn btn-success" name="WorkflowAction" value="Approve">
                    Approve
                </button>
                <button type="submit" class="btn btn-danger" name="WorkflowAction" value="Reject">
                    Reject
                </button>
            }
            else
            {
                <button type="submit" class="btn btn-outline-secondary" name="WorkflowAction" value="SavePending">
                    Save changes
                </button>
            }
        }
        <a class="btn btn-outline-secondary ms-md-2" asp-page="/Requests/Details" asp-route-id="@Model.RequestForm.Id">Cancel</a>
    </div>
</form>
